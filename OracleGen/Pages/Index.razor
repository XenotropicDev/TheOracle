@page "/"
@using TheOracle2.Data;
@using Newtonsoft.Json;
@using System.Linq;

<MudGrid Class="pa-4">
    <MudItem xs="6">
        <MudPaper Class="pa-4">
            <MudText Typo="Typo.h3" GutterBottom="true">OracleGen</MudText>
            <MudStack Row="true">
                <MudButton Variant="Variant.Filled" OnClick="LoadOracle1">Load Template (Action)</MudButton>
            </MudStack>

            <MudForm>
                <MudTextField T="string" Label="Oracle Name" @bind-Value="@oracle.Name" Required="true" RequiredError="Name is required!" />
                <MudTextField T="string" Label="Oracle Category" @bind-Value="@oracle.Category" />
                <MudTextField T="string" Label="Oracle Description" @bind-Value="@oracle.Description" Lines="4" />
                <MudText>Follow up/pair oracles</MudText>
                <MudTable @bind-SelectedItem="selectedPair" Items="@oracle.Usage.Suggestions.OracleRolls" ReadOnly="false">
                    <RowTemplate>
                        <MudTd DataLabel="Pair">@context.Oracle</MudTd>                        
                    </RowTemplate>
                    <RowEditingTemplate>
                        <MudTd DataLabel="Pair">
                            <MudTextField @bind-Value="@context.Oracle"/>
                        </MudTd>
                        <MudTd>
                            <MudIconButton Size="@Size.Small" Icon="@Icons.Material.Outlined.Delete" Class="pa-0" OnClick="deleteSuggestion" />
                        </MudTd>
                    </RowEditingTemplate>
                    <FooterContent>
                        <MudButton Variant="Variant.Filled" OnClick="AddSuggestionRow">Add Row</MudButton>
                    </FooterContent>
                </MudTable>
                <MudTable Items="@oracle.Table" Hover="true" Breakpoint="Breakpoint.Sm" LoadingProgressColor="Color.Info" ReadOnly="false">
                    <HeaderContent>
                        <MudTh>Floor</MudTh>
                        <MudTh>Ceiling</MudTh>
                        <MudTh>Result</MudTh>
                    </HeaderContent>
                    <RowTemplate>
                        <MudTd DataLabel="Floor">@context.Floor</MudTd>
                        <MudTd DataLabel="Ceiling">@context.Ceiling</MudTd>
                        <MudTd DataLabel="Result">@context.Result</MudTd>
                    </RowTemplate>
                    <RowEditingTemplate>
                        <MudTd DataLabel="Floor">
                            <MudNumericField @bind-Value="@context.Floor" Required Min="1" />
                            </MudTd>
                            <MudTd DataLabel="Ceiling">
                            <MudNumericField @bind-Value="@context.Ceiling" Required Min="1" />
                            </MudTd>
                            <MudTd DataLabel="Position">
                            <MudTextField @bind-Value="@context.Result" />
                            </MudTd>
                    </RowEditingTemplate>
                    <FooterContent>
                        <MudButton Variant="Variant.Filled" OnClick="AddTableRow">Add Row</MudButton>
                    </FooterContent>
                </MudTable>
            </MudForm>
        </MudPaper>
    </MudItem>
</MudGrid>


